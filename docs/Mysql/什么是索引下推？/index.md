# 什么是索引下推？

索引下推（Index Condition Pushdown, ICP）是MySQL优化器的一项优化技术，旨在提高通过索引检索数据的效率，尤其是在InnoDB存储引擎中。这项技术在MySQL 5.6中引入，专门用于减少从表中读取不必要的行，提高查询性能。

### 工作原理

在没有索引下推的情况下，当查询使用复合索引时，MySQL可能需要访问主表来评估不能完全通过索引条件确定的行。例如，如果只有索引的部分条件在索引中能被使用，而其他条件需要读取实际行再进行筛选，传统方式可能会导致更多的全行读取。

通过索引下推优化，MySQL可以在索引级别应用更多的查询过滤条件，从而减少读取主表的行数。

### 示例

假设有一个包含许多列的表 `products`，并为复合索引 `(category_id, price)` 创建以下查询：

```sql
SELECT * FROM products WHERE category_id = 5 AND price < 100;
```

如果复合索引 `(category_id, price)` 存在：

+ **无索引下推**：
  + MySQL根据`category_id = 5`条件使用索引检索数据，然后访问主表的每一行以评估`price < 100`条件。这可能导致访问许多不满足价格条件的行。
+ **有索引下推**：
  + MySQL在索引层面直接评估`price < 100`的条件，只需将符合条件的行从表中提取。这减少了对表的I/O操作。

### 适用场景

索引下推非常适合于查询条件中涉及多个列的过滤，且这些列存在复合索引的情况下。它可以在索引扫描过程中应用额外的过滤条件来减少所需的行访问。

### 优势

+ **减少I/O操作**：因为避免了对不必要的表记录的读取，所以可以大幅减少I/O操作。
+ **提高查询效率**：直接在索引层面筛选数据，进一步减少了需要处理的数据量。
+ **更快的响应时间**：整体上更有效的索引应用提高了查询响应速度。

索引下推是MySQL智能优化器功能迅速发展的一个体现，熟练使用及理解该功能有助于优化复杂查询和提升性能。
